<!--
SUMMARY:
Full-page Event Logger UI for GitHub Pages.
- Start button logs a Timestamp and reveals the full form.
- Required fields: Collection, Event.
- If StartDate is provided, StartTime is required.
- Photos uploaded are sent to the Apps Script with action 'uploadImage' and stored in the Drive folder for the selected Collection.
- After upload, an event payload with comma-separated photo URLs is posted to the Apps Script with action 'submitEvent'.
- Cancel clears all form state and hides the form.

CONFIG: Replace POST_URL with your Apps Script web app URL if different.
-->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Event Logger - Full Page</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 900px; margin: 16px auto; padding: 12px; }
  h1 { margin-bottom: 8px; }
  .hidden { }
  label { display: block; margin: 12px 0 6px; }
  input, select, textarea { width: 100%; padding: 8px; box-sizing: border-box; }
  .row { display: flex; gap: 12px; }
  .col { flex: 1; }
  .buttons { margin-top: 18px; display: flex; gap: 10px; }
  button { padding: 10px 14px; }
  #photoPreview img { max-width: 140px; margin-right: 8px; margin-bottom: 8px; display: inline-block; vertical-align: top; }
  #status { margin-top: 12px; color: #333; }
</style>
</head>
<body>

<h1>Event Logger - V2</h1>

<!-- Start button -->
<div id="startWrap">
  <button id="startBtn">Start New Event</button>
</div>

<!-- Full page form -->
<div id="formWrap" class="hidden">
  <form id="eventForm">
    <!-- Internal timestamp when the user clicked Start -->
    <input type="hidden" id="timestampInput" name="timestamp">

    <div class="row">
      <div class="col">
        <label for="startDate">Start Date (optional)</label>
        <input id="startDate" type="date" />
      </div>
      <div class="col">
        <label for="startTime">Start Time (required if date is used)</label>
        <input id="startTime" type="time" />
      </div>
    </div>

    <label for="duration">Duration (minutes)</label>
    <input id="duration" type="number" min="0" placeholder="e.g., 90" />

    <div class="row">
      <div class="col">
        <label for="collection">Collection (required)</label>
        <select id="collection" required>
          <option value="">Select collection</option>
          <option>Meal</option>
          <option>Bathroom</option>
          <option>Rest</option>
          <option>Activity</option>
        </select>
      </div>
      <div class="col">
        <label for="eventType">Event (required)</label>
        <input id="eventType" type="text" required placeholder="Event type" />
      </div>
    </div>

    <div class="row">
      <div class="col">
        <label for="sub1">SubEvent 1</label>
        <input id="sub1" type="text" />
      </div>
      <div class="col">
        <label for="sub2">SubEvent 2</label>
        <input id="sub2" type="text" />
      </div>
    </div>

    <label for="sub3">SubEvent 3</label>
    <input id="sub3" type="text" />

    <label for="rating">Rating</label>
    <input id="rating" type="text" />

    <label for="notes">Notes</label>
    <textarea id="notes" rows="3"></textarea>

    <label for="photos">Photos (choose one or more files)</label>
    <input id="photos" type="file" multiple accept="image/*" />

    <div id="photoPreview"></div>

    <div class="buttons">
      <button id="submitBtn" type="submit">Submit Event</button>
      <button id="cancelBtn" type="button">Cancel</button>
    </div>

    <div id="status" role="status" aria-live="polite"></div>
  </form>
</div>

<script>
const POST_URL = 'https://script.google.com/macros/s/AKfycbwfMT-H423YopgSpihB3kLORaAKCRkDGs35Wm12uIE0sUuivigMUGhC2fRmIIOCwaOS/exec';

async function submitEvent(data) {
  console.log('Submitting event data:', data);

  try {
    const response = await fetch(POST_URL, {
      method: 'POST',
      body: JSON.stringify(data),
      headers: { 'Content-Type': 'application/json' }
    });

    console.log('Raw response:', response);

    const json = await response.json();
    console.log('Parsed response:', json);

    if (json.status === 'success') {
      alert('Event submitted successfully!');
    } else {
      alert('Error: ' + json.message);
    }
  } catch (err) {
    console.error('Fetch error:', err);
    alert('Fetch failed: ' + err.message);
  }
}

// Example usage: triggered on form submit
document.getElementById('submitButton').addEventListener('click', function() {
  const data = {
    action: 'submitEvent',
    Timestamp: new Date().toISOString(),
    Collection: document.getElementById('collection').value,
    Event: document.getElementById('event').value,
    StartDate: document.getElementById('startDate').value,
    StartTime: document.getElementById('startTime').value,
    Duration: document.getElementById('duration').value,
    SubEvent_1: document.getElementById('sub1').value,
    SubEvent_2: document.getElementById('sub2').value,
    SubEvent_3: document.getElementById('sub3').value,
    Rating: document.getElementById('rating').value,
    Notes: document.getElementById('notes').value,
    Photo: document.getElementById('photoUrls').value
  };

  console.log('Form data prepared:', data);
  submitEvent(data);
});

</script>
</body>
</html>
